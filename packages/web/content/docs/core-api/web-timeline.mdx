---
title: Web Animation API (WAAPI)
description: High-performance, browser-native timeline powered by the Web Animations API.
---

The `webTimeline` API compiles your declarative animation tree into native browser keyframes and plays them using `Element.animate()`. This allows animations to run on the compositor thread (where possible), resulting in silky smooth performance even when the JavaScript main thread is busy.

### Example

```typescript
import { a } from "@freestylejs/ani-core";

// 1. Define the animation structure.
const myAnimation = a.sequence([
  a.ani({ to: { translateX: 100 }, duration: 1 }),
  a.ani({ to: { translateY: 100 }, duration: 1 }),
]);

// 2. Create a web-native timeline.
const timeline = a.webTimeline(myAnimation);

// 3. Play on a specific DOM element.
const element = document.getElementById("box");
if (element) {
    timeline.play(element, {
        from: { translateX: 0, translateY: 0 },
        repeat: Infinity
    });
}
```

### Usage & Concepts

#### Overview

Unlike the standard `timeline` which runs frame-by-frame via JavaScript, `webTimeline` uses the browser's native animation engine. This offers significant performance benefits, especially for continuous animations (loops) or on lower-end devices.

Because it runs natively, `webTimeline` does not emit `onUpdate` events. State management is handled entirely by the browser's CSSOM.

#### Key Differences from `timeline`

| Feature | `timeline` (JS) | `webTimeline` (Native) |
| :--- | :--- | :--- |
| **Engine** | JavaScript `requestAnimationFrame` | Browser `Element.animate()` |
| **Performance** | Good, but blocked by main thread | Excellent, often compositor-threaded |
| **Events** | `onUpdate` for every frame | No frame updates |
| **Properties** | Any numeric property | CSS properties only |

#### Best Practices

- **Do** use `webTimeline` for purely visual UI transitions (fades, slides, scaling) and infinite background loops.
- **Do** use standard CSS property names like `translateX` instead of shorthands like `x` to ensure compatibility.
- **Don't** use `webTimeline` if you need to sync non-DOM elements (like Canvas or WebGL) or if you need to react to value changes every frame.

#### Limitation: Static Destinations

A critical difference between `webTimeline` and the standard `timeline` is how they handle dynamic values.

-   **Standard `timeline`**: Supports dynamic overrides for **both** start (`from`) and end (`to`) values via the `keyframes` property in `play()`.
-   **`webTimeline`**: Supports dynamic overrides **only** for the start (`from`) value. The destination values (`to`) are **fixed** when you create the timeline structure.

This means `webTimeline` is **not suitable** for animations where the target changes based on user interaction (e.g., moving an element to the mouse cursor position). It is best used for "static" animations where the movement pattern is pre-defined, such as loading spinners, entrance animations, or fixed-distance hover effects.

#### Timing Functions

Since `webTimeline` compiles to native CSS Keyframes, standard easing functions are compiled directly to CSS strings, while complex physics-based timings are **sampled** into a series of linear keyframes.

| Timing Function | Compilation Behavior |
| :--- | :--- |
| `linear()` | Compiles to `linear`. |
| `bezier()` | Compiles to `cubic-bezier(...)`. |
| `spring()` | **Supported**. Sampled into high-density linear keyframes (60fps). |
| `dynamicSpring()` | **Not Supported**. Requires frame-by-frame stateful simulation. |
| Custom | **Supported**. Sampled, provided the function is stateless (pure function of time). |

> **Note:** Using `spring()` or custom timing functions with `webTimeline` will generate a larger number of keyframes to approximate the curve. This is generally performant but significantly more verbose than standard CSS easing. Stateful animations like `dynamicSpring` (which depend on velocity from the previous frame) cannot be pre-compiled and are not supported.

### API Reference

#### Methods

| Method | Description |
| :--- | :--- |
| `play(target, config)` | Compiles and plays the animation on the target DOM element. Returns the native `Animation` object. |
| `pause()` | Pauses the native animation. |
| `resume()` | Resumes the native animation. |
| `cancel()` | Cancels the animation and removes effects. |
| `seek(time)` | Jumps to a specific time (in seconds). |
| `nativeAnimation` | Getter to access the underlying WAAPI `Animation` instance. |

#### Type Definitions

```typescript
function webTimeline<G extends Groupable>(rootNode: AnimationNode<G>): WebAniTimeline<G>;

interface WebAniTimelineConfig<G extends Groupable> {
    from: G;
    repeat?: number; // Defaults to 1. Use Infinity for loops.
    delay?: number; // milliseconds
}

interface WebAniTimeline<G extends Groupable> {
    play(target: Element, config: WebAniTimelineConfig<G>): Animation | null;
    pause(): void;
    resume(): void;
    cancel(): void;
    seek(time: number): void;
    get nativeAnimation(): Animation | null;
}
```

### Related Components

-   [`timeline`](/en/docs/core-api/timeline) - The standard JavaScript-based controller.
-   [`ani`](/en/docs/core-api/ani) - The building block for animations.
